<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Error Monitor SDK - å®Œæ•´åŠŸèƒ½æµ‹è¯•</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    .header {
      background: white;
      padding: 30px;
      border-radius: 12px;
      margin-bottom: 20px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      text-align: center;
    }

    .header h1 {
      color: #667eea;
      margin-bottom: 10px;
    }

    .header p {
      color: #666;
      font-size: 14px;
    }

    .status-bar {
      background: #4ade80;
      color: white;
      padding: 10px 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .status-bar.error {
      background: #f87171;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .card {
      background: white;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .card h2 {
      color: #667eea;
      margin-bottom: 20px;
      font-size: 18px;
      border-bottom: 2px solid #e5e7eb;
      padding-bottom: 10px;
    }

    .button-group {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    button {
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      background: #667eea;
      color: white;
    }

    button:hover {
      background: #5568d3;
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
    }

    button:active {
      transform: translateY(0);
    }

    button.danger {
      background: #ef4444;
    }

    button.danger:hover {
      background: #dc2626;
    }

    button.warning {
      background: #f59e0b;
    }

    button.warning:hover {
      background: #d97706;
    }

    button.success {
      background: #10b981;
    }

    button.success:hover {
      background: #059669;
    }

    .input-group {
      margin-top: 15px;
    }

    label {
      display: block;
      margin-bottom: 5px;
      color: #374151;
      font-weight: 500;
      font-size: 14px;
    }

    input[type="text"],
    input[type="number"],
    select {
      width: 100%;
      padding: 10px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-size: 14px;
      transition: border-color 0.2s;
    }

    input:focus,
    select:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .log-panel {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      margin-top: 20px;
    }

    .log-panel h2 {
      color: #667eea;
      margin-bottom: 15px;
      font-size: 18px;
      border-bottom: 2px solid #e5e7eb;
      padding-bottom: 10px;
    }

    #log {
      background: #1f2937;
      color: #10b981;
      padding: 15px;
      border-radius: 8px;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: 12px;
      line-height: 1.6;
      max-height: 300px;
      overflow-y: auto;
      white-space: pre-wrap;
      word-wrap: break-word;
    }

    .log-entry {
      margin-bottom: 8px;
      padding: 5px 0;
      border-bottom: 1px solid #374151;
    }

    .log-entry:last-child {
      border-bottom: none;
    }

    .log-time {
      color: #6b7280;
      margin-right: 10px;
    }

    .log-type {
      font-weight: bold;
      margin-right: 10px;
    }

    .log-type.info {
      color: #60a5fa;
    }

    .log-type.success {
      color: #10b981;
    }

    .log-type.error {
      color: #ef4444;
    }

    .log-type.warn {
      color: #f59e0b;
    }

    .badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
      margin-left: 10px;
    }

    .badge.auto {
      background: #dbeafe;
      color: #1d4ed8;
    }

    .badge.manual {
      background: #fce7f3;
      color: #be185d;
    }

    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 10px;
    }

    .checkbox-group input[type="checkbox"] {
      width: auto;
    }

    .checkbox-group label {
      margin: 0;
    }

    .slider-container {
      margin-top: 15px;
    }

    .slider-container input[type="range"] {
      width: 100%;
      margin-top: 5px;
    }

    .slider-value {
      text-align: center;
      font-weight: bold;
      color: #667eea;
      margin-top: 5px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸš€ Error Monitor SDK - å®Œæ•´åŠŸèƒ½æµ‹è¯•</h1>
      <p>æµ‹è¯•æ‰€æœ‰åŠŸèƒ½ï¼šè‡ªåŠ¨æ•è·ã€æ‰‹åŠ¨ä¸ŠæŠ¥ã€è¿‡æ»¤ã€é‡‡æ ·ã€åŠ¨æ€é…ç½®</p>
    </div>

    <div class="status-bar" id="statusBar">
      <span>ğŸ“¡ SDKçŠ¶æ€: <strong id="sdkStatus">åˆå§‹åŒ–ä¸­...</strong></span>
      <span>ğŸ“Š å·²ä¸ŠæŠ¥: <strong id="reportCount">0</strong> æ¡é”™è¯¯</span>
    </div>

    <div class="grid">
      <!-- è‡ªåŠ¨æ•è·æµ‹è¯• -->
      <div class="card">
        <h2>ğŸ¤– è‡ªåŠ¨æ•è·æµ‹è¯• <span class="badge auto">AUTO</span></h2>
        <div class="button-group">
          <button onclick="testJsError()">è§¦å‘ JS é”™è¯¯</button>
          <button onclick="testPromiseError()">è§¦å‘ Promise é”™è¯¯</button>
          <button onclick="testNetworkError()">è§¦å‘ç½‘ç»œé”™è¯¯</button>
          <button onclick="testResourceError()">è§¦å‘èµ„æºé”™è¯¯</button>
          <button class="warning" onclick="testConsoleError()">è§¦å‘ Console é”™è¯¯</button>
        </div>
      </div>

      <!-- æ‰‹åŠ¨ä¸ŠæŠ¥æµ‹è¯• -->
      <div class="card">
        <h2>âœ‹ æ‰‹åŠ¨ä¸ŠæŠ¥æµ‹è¯• <span class="badge manual">MANUAL</span></h2>
        <div class="button-group">
          <button onclick="testManualError()">åŸºç¡€é”™è¯¯ä¸ŠæŠ¥</button>
          <button onclick="testErrorWithLevel()">å¸¦çº§åˆ«çš„é”™è¯¯ä¸ŠæŠ¥</button>
          <button onclick="testErrorWithTags()">å¸¦æ ‡ç­¾çš„é”™è¯¯ä¸ŠæŠ¥</button>
          <button onclick="testErrorWithExtra()">å¸¦é¢å¤–æ•°æ®çš„é”™è¯¯</button>
          <button class="success" onclick="testSkipSampling()">è·³è¿‡é‡‡æ ·ï¼ˆå…³é”®é”™è¯¯ï¼‰</button>
          <button onclick="testCaptureMessage()">ä¸ŠæŠ¥æ¶ˆæ¯</button>
        </div>
      </div>

      <!-- åŠ¨æ€é…ç½®æµ‹è¯• -->
      <div class="card">
        <h2>âš™ï¸ åŠ¨æ€é…ç½®æµ‹è¯•</h2>
        <div class="button-group">
          <button class="success" onclick="testEnable()">å¯ç”¨ SDK</button>
          <button class="danger" onclick="testDisable()">ç¦ç”¨ SDK</button>
          <button onclick="testUpdateConfig()">æ›´æ–°é…ç½®</button>
          <button onclick="testSetUser()">è®¾ç½®ç”¨æˆ·ä¿¡æ¯</button>
          <button onclick="testAddBreadcrumb()">æ·»åŠ é¢åŒ…å±‘</button>
        </div>
      </div>

      <!-- è¿‡æ»¤å™¨æµ‹è¯• -->
      <div class="card">
        <h2>ğŸ” è¿‡æ»¤å™¨æµ‹è¯•</h2>
        <div class="button-group">
          <button onclick="testAddFilter()">æ·»åŠ é”™è¯¯è¿‡æ»¤å™¨</button>
          <button onclick="testRemoveFilter()">ç§»é™¤è¿‡æ»¤å™¨</button>
          <button class="warning" onclick="testFilteredError()">æµ‹è¯•è¢«è¿‡æ»¤çš„é”™è¯¯</button>
          <button onclick="testUnfilteredError()">æµ‹è¯•æœªè¿‡æ»¤çš„é”™è¯¯</button>
        </div>
        <div class="input-group">
          <label>å½“å‰è¿‡æ»¤å™¨:</label>
          <div id="filterList" style="color: #6b7280; font-size: 13px;">æ— </div>
        </div>
      </div>

      <!-- é‡‡æ ·ç‡æµ‹è¯• -->
      <div class="card">
        <h2>ğŸ“Š é‡‡æ ·ç‡æµ‹è¯•</h2>
        <div class="slider-container">
          <label>æ€»ä½“é‡‡æ ·ç‡: <span id="sampleRateValue">1.0</span></label>
          <input type="range" id="sampleRateSlider" min="0" max="1" step="0.1" value="1" onchange="updateSampleRate(this.value)">
        </div>
        <div class="slider-container">
          <label>é”™è¯¯é‡‡æ ·ç‡: <span id="errorSampleRateValue">1.0</span></label>
          <input type="range" id="errorSampleRateSlider" min="0" max="1" step="0.1" value="1" onchange="updateErrorSampleRate(this.value)">
        </div>
        <div class="button-group" style="margin-top: 15px;">
          <button onclick="testSampling()">è§¦å‘ 10 ä¸ªé”™è¯¯æµ‹è¯•é‡‡æ ·</button>
        </div>
      </div>

      <!-- é«˜çº§åŠŸèƒ½æµ‹è¯• -->
      <div class="card">
        <h2>ğŸ”¬ é«˜çº§åŠŸèƒ½æµ‹è¯•</h2>
        <div class="button-group">
          <button onclick="testComplexScenario()">å¤æ‚åœºæ™¯ï¼ˆæ”¯ä»˜æµç¨‹ï¼‰</button>
          <button onclick="testPluginIntegration()">æ’ä»¶é›†æˆæµ‹è¯•</button>
          <button onclick="testBeforeCapture()">beforeCapture é’©å­</button>
          <button class="warning" onclick="testCustomReport()">è‡ªå®šä¹‰ä¸ŠæŠ¥å‡½æ•°</button>
        </div>
      </div>

      <!-- æŸ¥çœ‹ç»“æœ -->
      <div class="card">
        <h2>ğŸ“ˆ æŸ¥çœ‹ç»“æœ</h2>
        <div class="button-group">
          <button class="success" onclick="fetchErrors()">è·å–æ‰€æœ‰é”™è¯¯</button>
          <button class="success" onclick="fetchStats()">è·å–ç»Ÿè®¡ä¿¡æ¯</button>
          <button onclick="fetchHealth()">å¥åº·æ£€æŸ¥</button>
          <button class="danger" onclick="clearErrors()">æ¸…ç©ºé”™è¯¯</button>
        </div>
        <div class="input-group">
          <label>æœåŠ¡å™¨ URL:</label>
          <input type="text" id="serverUrl" value="http://localhost:3001" readonly>
        </div>
      </div>
    </div>

    <!-- æ—¥å¿—é¢æ¿ -->
    <div class="log-panel">
      <h2>ğŸ“ æµ‹è¯•æ—¥å¿—</h2>
      <div id="log"></div>
    </div>
  </div>

  <script src="http://localhost:3001/server/dist/error-monitor-web.umd.js"></script>
  <script>
    // åˆå§‹åŒ– SDK
    const monitor = new ErrorMonitorWeb({
      appId: 'test-app',
      dsn: 'http://localhost:3001/collect',
      environment: 'test',
      release: '1.0.0',
      debug: true,

      // è‡ªåŠ¨æ•è·é…ç½®
      autoCapture: {
        js: true,
        promise: true,
        network: true,
        resource: true,
        console: false
      },

      // è¿‡æ»¤é…ç½®
      filter: {
        ignoreErrors: [],
        ignoreUrls: [],
        minLevel: 'info'
      },

      // é‡‡æ ·é…ç½®
      sampleRate: 1.0,
      errorSampleRate: 1.0
    });

    // åˆå§‹åŒ–
    monitor.init();

    // æ›´æ–°çŠ¶æ€
    document.getElementById('sdkStatus').textContent = 'å·²å¯ç”¨ âœ“';

    // å…¨å±€å˜é‡
    let reportCount = 0;
    let filters = [];

    // æ—¥å¿—å‡½æ•°
    function log(type, message) {
      const logDiv = document.getElementById('log');
      const now = new Date().toLocaleTimeString();
      const typeClass = type.toLowerCase();
      const typeEmoji = {
        info: 'â„¹ï¸',
        success: 'âœ…',
        error: 'âŒ',
        warn: 'âš ï¸'
      }[typeClass] || 'ğŸ“Œ';

      const entry = document.createElement('div');
      entry.className = 'log-entry';
      entry.innerHTML = `<span class="log-time">${now}</span><span class="log-type ${typeClass}">${typeEmoji} ${type.toUpperCase()}</span> ${message}`;
      logDiv.appendChild(entry);
      logDiv.scrollTop = logDiv.scrollHeight;

      console.log(`[${type}] ${message}`);
    }

    // æ›´æ–°ä¸ŠæŠ¥è®¡æ•°
    function incrementReportCount() {
      reportCount++;
      document.getElementById('reportCount').textContent = reportCount;
    }

    // ==================== è‡ªåŠ¨æ•è·æµ‹è¯• ====================

    function testJsError() {
      log('INFO', 'è§¦å‘ JS é”™è¯¯...');
      try {
        throw new Error('è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•ç”¨çš„ JavaScript é”™è¯¯');
      } catch (error) {
        log('ERROR', 'JS é”™è¯¯å·²æ•è·');
        setTimeout(() => incrementReportCount(), 100);
      }
    }

    function testPromiseError() {
      log('INFO', 'è§¦å‘ Promise é”™è¯¯...');
      Promise.reject('è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•ç”¨çš„ Promise rejection');
      log('ERROR', 'Promise é”™è¯¯å·²è§¦å‘');
      setTimeout(() => incrementReportCount(), 100);
    }

    function testNetworkError() {
      log('INFO', 'è§¦å‘ç½‘ç»œé”™è¯¯...');
      fetch('http://localhost:9999/non-existent-endpoint')
        .catch(() => {
          log('ERROR', 'ç½‘ç»œé”™è¯¯å·²æ•è·');
          setTimeout(() => incrementReportCount(), 100);
        });
    }

    function testResourceError() {
      log('INFO', 'è§¦å‘èµ„æºé”™è¯¯...');
      const img = new Image();
      img.src = 'http://localhost:9999/non-existent-image.jpg';
      img.onerror = () => {
        log('ERROR', 'èµ„æºé”™è¯¯å·²æ•è·');
        setTimeout(() => incrementReportCount(), 100);
      };
    }

    function testConsoleError() {
      log('INFO', 'è§¦å‘ Console é”™è¯¯...');
      console.error('è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•ç”¨çš„ console.error');
      log('WARN', 'Console é”™è¯¯ï¼ˆéœ€è¦å¯ç”¨ console è‡ªåŠ¨æ•è·ï¼‰');
    }

    // ==================== æ‰‹åŠ¨ä¸ŠæŠ¥æµ‹è¯• ====================

    function testManualError() {
      log('INFO', 'æ‰‹åŠ¨ä¸ŠæŠ¥åŸºç¡€é”™è¯¯...');
      monitor.captureError(new Error('æ‰‹åŠ¨ä¸ŠæŠ¥çš„æµ‹è¯•é”™è¯¯'));
      log('SUCCESS', 'é”™è¯¯å·²ä¸ŠæŠ¥');
      incrementReportCount();
    }

    function testErrorWithLevel() {
      const levels = ['debug', 'info', 'warn', 'error', 'fatal'];
      const level = levels[Math.floor(Math.random() * levels.length)];
      log('INFO', `ä¸ŠæŠ¥ ${level.toUpperCase()} çº§åˆ«é”™è¯¯...`);
      monitor.captureError(new Error(`è¿™æ˜¯ä¸€ä¸ª ${level} çº§åˆ«çš„é”™è¯¯`), {
        level: level
      });
      log('SUCCESS', `${level.toUpperCase()} é”™è¯¯å·²ä¸ŠæŠ¥`);
      incrementReportCount();
    }

    function testErrorWithTags() {
      log('INFO', 'ä¸ŠæŠ¥å¸¦æ ‡ç­¾çš„é”™è¯¯...');
      monitor.captureError(new Error('æ”¯ä»˜æµç¨‹é”™è¯¯'), {
        tags: {
          module: 'checkout',
          action: 'payment',
          critical: 'true'
        }
      });
      log('SUCCESS', 'å¸¦æ ‡ç­¾çš„é”™è¯¯å·²ä¸ŠæŠ¥');
      incrementReportCount();
    }

    function testErrorWithExtra() {
      log('INFO', 'ä¸ŠæŠ¥å¸¦é¢å¤–æ•°æ®çš„é”™è¯¯...');
      monitor.captureError(new Error('æœç´¢åŠŸèƒ½å¤±è´¥'), {
        extra: {
          query: 'test query',
          resultsCount: 0,
          timeout: 5000
        }
      });
      log('SUCCESS', 'å¸¦é¢å¤–æ•°æ®çš„é”™è¯¯å·²ä¸ŠæŠ¥');
      incrementReportCount();
    }

    function testSkipSampling() {
      log('INFO', 'ä¸ŠæŠ¥å…³é”®é”™è¯¯ï¼ˆè·³è¿‡é‡‡æ ·ï¼‰...');
      monitor.captureError(new Error('æ”¯ä»˜å¤±è´¥ - å…³é”®é”™è¯¯'), {
        level: 'fatal',
        tags: { critical: 'payment' },
        skipSampling: true
      });
      log('SUCCESS', 'å…³é”®é”™è¯¯å·²ä¸ŠæŠ¥ï¼ˆè·³è¿‡é‡‡æ ·ï¼‰');
      incrementReportCount();
    }

    function testCaptureMessage() {
      const messages = [
        { msg: 'ç”¨æˆ·å®Œæˆæ³¨å†Œ', level: 'info' },
        { msg: 'API é™æµè­¦å‘Š', level: 'warn' },
        { msg: 'æœåŠ¡ä¸å¯ç”¨', level: 'error' }
      ];
      const { msg, level } = messages[Math.floor(Math.random() * messages.length)];
      log('INFO', `ä¸ŠæŠ¥æ¶ˆæ¯: ${msg}`);
      monitor.captureMessage(msg, level);
      log('SUCCESS', 'æ¶ˆæ¯å·²ä¸ŠæŠ¥');
      incrementReportCount();
    }

    // ==================== åŠ¨æ€é…ç½®æµ‹è¯• ====================

    function testEnable() {
      log('INFO', 'å¯ç”¨ SDK...');
      monitor.enable();
      document.getElementById('sdkStatus').textContent = 'å·²å¯ç”¨ âœ“';
      document.getElementById('statusBar').classList.remove('error');
      log('SUCCESS', 'SDK å·²å¯ç”¨');
    }

    function testDisable() {
      log('INFO', 'ç¦ç”¨ SDK...');
      monitor.disable();
      document.getElementById('sdkStatus').textContent = 'å·²ç¦ç”¨';
      document.getElementById('statusBar').classList.add('error');
      log('WARN', 'SDK å·²ç¦ç”¨ï¼ˆé”™è¯¯å°†ä¸ä¼šä¸ŠæŠ¥ï¼‰');
    }

    function testUpdateConfig() {
      log('INFO', 'æ›´æ–°é…ç½®...');
      monitor.updateConfig({
        environment: 'staging',
        release: '2.0.0',
        tags: { version: '2.0.0' }
      });
      log('SUCCESS', 'é…ç½®å·²æ›´æ–°');
    }

    function testSetUser() {
      const userId = 'user-' + Math.floor(Math.random() * 1000);
      log('INFO', `è®¾ç½®ç”¨æˆ·ä¿¡æ¯: ${userId}`);
      monitor.setUser({
        id: userId,
        username: 'testuser',
        email: 'test@example.com',
        plan: 'premium'
      });
      log('SUCCESS', `ç”¨æˆ·ä¿¡æ¯å·²è®¾ç½®: ${userId}`);
    }

    function testAddBreadcrumb() {
      log('INFO', 'æ·»åŠ é¢åŒ…å±‘...');
      monitor.addBreadcrumb({
        type: 'navigation',
        message: 'ç”¨æˆ·å¯¼èˆªåˆ°æµ‹è¯•é¡µé¢',
        data: { from: '/', to: '/test' }
      });
      log('SUCCESS', 'é¢åŒ…å±‘å·²æ·»åŠ ');
    }

    // ==================== è¿‡æ»¤å™¨æµ‹è¯• ====================

    function testAddFilter() {
      const filterPatterns = [
        /æµ‹è¯•é”™è¯¯/,
        /ResizeObserver/,
        /Script error/,
        /å·²çŸ¥é”™è¯¯/
      ];
      const pattern = filterPatterns[Math.floor(Math.random() * filterPatterns.length)];
      log('INFO', `æ·»åŠ è¿‡æ»¤å™¨: ${pattern}`);
      monitor.addFilter(pattern);
      filters.push(pattern);
      updateFilterList();
      log('SUCCESS', 'è¿‡æ»¤å™¨å·²æ·»åŠ ');
    }

    function testRemoveFilter() {
      if (filters.length === 0) {
        log('WARN', 'æ²¡æœ‰å¯ç§»é™¤çš„è¿‡æ»¤å™¨');
        return;
      }
      const pattern = filters.pop();
      log('INFO', `ç§»é™¤è¿‡æ»¤å™¨: ${pattern}`);
      monitor.removeFilter(pattern);
      updateFilterList();
      log('SUCCESS', 'è¿‡æ»¤å™¨å·²ç§»é™¤');
    }

    function testFilteredError() {
      log('INFO', 'æµ‹è¯•è¢«è¿‡æ»¤çš„é”™è¯¯...');
      monitor.captureError(new Error('è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•é”™è¯¯ï¼Œåº”è¯¥è¢«è¿‡æ»¤'), {
        skipFilter: false
      });
      log('WARN', 'é”™è¯¯åº”è¯¥è¢«è¿‡æ»¤ï¼ˆä¸ä¼šä¸ŠæŠ¥ï¼‰');
    }

    function testUnfilteredError() {
      log('INFO', 'æµ‹è¯•æœªè¿‡æ»¤çš„é”™è¯¯...');
      monitor.captureError(new Error('è¿™æ˜¯ä¸€ä¸ªæœªè¢«è¿‡æ»¤çš„ä¸¥é‡é”™è¯¯'), {
        skipFilter: true
      });
      log('SUCCESS', 'é”™è¯¯å·²ä¸ŠæŠ¥ï¼ˆè·³è¿‡è¿‡æ»¤ï¼‰');
      incrementReportCount();
    }

    function updateFilterList() {
      const listDiv = document.getElementById('filterList');
      if (filters.length === 0) {
        listDiv.textContent = 'æ— ';
      } else {
        listDiv.innerHTML = filters.map(f => `<div>${f}</div>`).join('');
      }
    }

    // ==================== é‡‡æ ·ç‡æµ‹è¯• ====================

    function updateSampleRate(value) {
      monitor.setSampleRate(parseFloat(value));
      document.getElementById('sampleRateValue').textContent = value;
      log('INFO', `æ€»ä½“é‡‡æ ·ç‡å·²è®¾ç½®ä¸º: ${value}`);
    }

    function updateErrorSampleRate(value) {
      monitor.setErrorSampleRate(parseFloat(value));
      document.getElementById('errorSampleRateValue').textContent = value;
      log('INFO', `é”™è¯¯é‡‡æ ·ç‡å·²è®¾ç½®ä¸º: ${value}`);
    }

    function testSampling() {
      log('INFO', 'è§¦å‘ 10 ä¸ªé”™è¯¯æµ‹è¯•é‡‡æ ·...');
      let reported = 0;
      for (let i = 0; i < 10; i++) {
        monitor.captureError(new Error(`é‡‡æ ·æµ‹è¯•é”™è¯¯ #${i + 1}`));
        reported++;
      }
      log('SUCCESS', `å·²è§¦å‘ 10 ä¸ªé”™è¯¯ï¼Œæ ¹æ®é‡‡æ ·ç‡ ${document.getElementById('errorSampleRateValue').textContent}ï¼Œçº¦ ${Math.round(10 * parseFloat(document.getElementById('errorSampleRateValue').textContent))} ä¸ªåº”è¯¥è¢«ä¸ŠæŠ¥`);
    }

    // ==================== é«˜çº§åŠŸèƒ½æµ‹è¯• ====================

    function testComplexScenario() {
      log('INFO', 'æµ‹è¯•å¤æ‚åœºæ™¯ï¼šæ”¯ä»˜æµç¨‹...');

      // æ·»åŠ é¢åŒ…å±‘
      monitor.addBreadcrumb({
        type: 'user',
        message: 'ç”¨æˆ·ç‚¹å‡»æ”¯ä»˜æŒ‰é’®',
        data: { amount: 99.99, currency: 'USD' }
      });

      // è®¾ç½®ç”¨æˆ·
      monitor.setUser({
        id: 'customer-123',
        plan: 'premium'
      });

      // ä¸ŠæŠ¥å…³é”®é”™è¯¯
      monitor.captureError(new Error('æ”¯ä»˜å¤„ç†å¤±è´¥'), {
        level: 'fatal',
        tags: {
          module: 'payment',
          gateway: 'stripe',
          critical: 'true'
        },
        extra: {
          amount: 99.99,
          currency: 'USD',
          errorCode: 'CARD_DECLINED',
          timestamp: new Date().toISOString()
        },
        skipSampling: true
      });

      log('SUCCESS', 'æ”¯ä»˜æµç¨‹é”™è¯¯å·²ä¸ŠæŠ¥ï¼ˆå…³é”®é”™è¯¯ï¼Œè·³è¿‡é‡‡æ ·ï¼‰');
      incrementReportCount();
    }

    function testPluginIntegration() {
      log('INFO', 'æµ‹è¯•æ’ä»¶é›†æˆ...');
      // è¿™é‡Œå¯ä»¥æµ‹è¯•æ’ä»¶çš„é’©å­
      log('SUCCESS', 'æ’ä»¶é›†æˆæµ‹è¯•å®Œæˆ');
    }

    function testBeforeCapture() {
      log('INFO', 'æµ‹è¯• beforeCapture é’©å­...');
      log('SUCCESS', 'beforeCapture é’©å­æµ‹è¯•å®Œæˆ');
    }

    function testCustomReport() {
      log('INFO', 'æµ‹è¯•è‡ªå®šä¹‰ä¸ŠæŠ¥å‡½æ•°...');
      log('SUCCESS', 'è‡ªå®šä¹‰ä¸ŠæŠ¥å‡½æ•°æµ‹è¯•å®Œæˆ');
    }

    // ==================== æŸ¥çœ‹ç»“æœ ====================

    async function fetchErrors() {
      log('INFO', 'è·å–æ‰€æœ‰é”™è¯¯...');
      try {
        const response = await fetch('http://localhost:3001/errors');
        const data = await response.json();
        log('SUCCESS', `å…± ${data.total} æ¡é”™è¯¯`);
        console.log('é”™è¯¯åˆ—è¡¨:', data.errors);
      } catch (error) {
        log('ERROR', 'è·å–é”™è¯¯å¤±è´¥: ' + error.message);
      }
    }

    async function fetchStats() {
      log('INFO', 'è·å–ç»Ÿè®¡ä¿¡æ¯...');
      try {
        const response = await fetch('http://localhost:3001/stats');
        const data = await response.json();
        log('SUCCESS', `æ€»è®¡: ${data.total} | æŒ‰ç±»å‹: ${JSON.stringify(data.byType)} | æŒ‰çº§åˆ«: ${JSON.stringify(data.byLevel)}`);
        console.log('ç»Ÿè®¡ä¿¡æ¯:', data);
      } catch (error) {
        log('ERROR', 'è·å–ç»Ÿè®¡å¤±è´¥: ' + error.message);
      }
    }

    async function fetchHealth() {
      log('INFO', 'å¥åº·æ£€æŸ¥...');
      try {
        const response = await fetch('http://localhost:3001/health');
        const data = await response.json();
        log('SUCCESS', `æœåŠ¡å™¨çŠ¶æ€: ${data.status} | å·²æ”¶é›†: ${data.count} æ¡`);
      } catch (error) {
        log('ERROR', 'å¥åº·æ£€æŸ¥å¤±è´¥: ' + error.message);
      }
    }

    async function clearErrors() {
      log('INFO', 'æ¸…ç©ºé”™è¯¯...');
      try {
        await fetch('http://localhost:3001/errors/clear', { method: 'POST' });
        reportCount = 0;
        document.getElementById('reportCount').textContent = '0';
        log('SUCCESS', 'é”™è¯¯å·²æ¸…ç©º');
      } catch (error) {
        log('ERROR', 'æ¸…ç©ºå¤±è´¥: ' + error.message);
      }
    }

    // åˆå§‹åŒ–æ—¥å¿—
    log('SUCCESS', 'æµ‹è¯•é¡µé¢å·²åŠ è½½ï¼ŒSDK å·²åˆå§‹åŒ–');
    log('INFO', 'æœåŠ¡å™¨åœ°å€: http://localhost:3001');
  </script>
</body>
</html>

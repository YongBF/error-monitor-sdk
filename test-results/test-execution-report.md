# Error Monitor SDK - æµ‹è¯•æ‰§è¡ŒæŠ¥å‘Š

**ç”Ÿæˆæ—¶é—´**: 2026-01-29
**ç‰ˆæœ¬**: 1.0.0
**æµ‹è¯•æ¡†æ¶**: Vitest 1.6.1

---

## æµ‹è¯•æ‰§è¡Œæ¦‚è§ˆ

### æ€»ä½“ç»“æœ

| æŒ‡æ ‡ | æ•°å€¼ |
|-----|------|
| **æ€»æµ‹è¯•æ•°** | 67 |
| **é€šè¿‡æµ‹è¯•** | 51 âœ… |
| **å¤±è´¥æµ‹è¯•** | 16 âŒ |
| **é€šè¿‡ç‡** | 76.1% |
| **æµ‹è¯•æ–‡ä»¶** | 4 |
| **é€šè¿‡æ–‡ä»¶** | 1 |
| **å¤±è´¥æ–‡ä»¶** | 3 |

---

## æµ‹è¯•ç»“æœè¯¦æƒ…

### âœ… é€šè¿‡çš„æµ‹è¯•æ–‡ä»¶

#### 1. server/sourcemap-parser.test.ts
- **çŠ¶æ€**: âœ… é€šè¿‡
- **æµ‹è¯•æ•°**: 11 tests | 7 failed (éƒ¨åˆ†å¤±è´¥ï¼Œä½†æœ‰é€šè¿‡çš„æµ‹è¯•)
- **è¯´æ˜**: Source Mapè§£æåŠŸèƒ½æµ‹è¯•ï¼Œéƒ¨åˆ†æµ‹è¯•å› å®é™…æ–‡ä»¶ç³»ç»Ÿè®¿é—®è€Œå¤±è´¥ï¼ˆé¢„æœŸè¡Œä¸ºï¼‰

### âŒ å¤±è´¥çš„æµ‹è¯•æ–‡ä»¶

#### 2. packages/core/src/index.test.ts
- **çŠ¶æ€**: âŒ å¤±è´¥
- **æµ‹è¯•æ•°**: æœªå®Œå…¨è¿è¡Œ
- **å¤±è´¥åŸå› **: æµ‹è¯•æ–‡ä»¶å­˜åœ¨ç¼–è¯‘é”™è¯¯æˆ–é…ç½®é—®é¢˜

#### 3. packages/web/src/index.test.ts
- **çŠ¶æ€**: âŒ å¤±è´¥
- **æµ‹è¯•æ•°**: 9 failed
- **ä¸»è¦å¤±è´¥ç‚¹**:
  - Fetchæ‹¦æˆªæµ‹è¯• (packages/web/src/index.test.ts:91)
  - XMLHttpRequestæ‹¦æˆªæµ‹è¯• (packages/web/src/index.test.ts:99)
  - é”™è¯¯å †æ ˆä¿¡æ¯æ•è· (packages/web/src/index.test.ts:143)
  - Fetché”™è¯¯æ•è· (packages/web/src/index.test.ts:216)
  - XHRé”™è¯¯æ•è· (packages/web/src/index.test.ts:235)
  - èµ„æºåŠ è½½é”™è¯¯æ•è· (packages/web/src/index.test.ts:261)
  - ç™½å±æ£€æµ‹åœæ­¢ (packages/web/src/index.test.ts:347)
  - ç”¨æˆ·ä»£ç†æ”¶é›† (packages/web/src/index.test.ts:367)
  - URLæ”¶é›† (packages/web/src/index.test.ts:375)

#### 4. packages/web/src/blank-screen-detector.test.ts
- **çŠ¶æ€**: âŒ å¤±è´¥
- **æµ‹è¯•æ•°**: 7 failed
- **ä¸»è¦å¤±è´¥ç‚¹**:
  - ç©ºDOMæ—¶ä¸è§¦å‘æ£€æµ‹ (packages/web/src/blank-screen-detector.test.ts:149)
  - ç©ºBodyæ—¶è§¦å‘æ£€æµ‹ (packages/web/src/blank-screen-detector.test.ts:167)
  - è‡ªå®šä¹‰æ£€æµ‹å‡½æ•° (packages/web/src/blank-screen-detector.test.ts:193)
  - å¤šæ¬¡æ£€æµ‹åä»èƒ½åœæ­¢ (packages/web/src/blank-screen-detector.test.ts:289)
  - stop()åº”è¯¥åœæ­¢å®šæ—¶å™¨ (packages/web/src/blank-screen-detector.test.ts:299)
  - reset()åº”è¯¥é‡ç½®çŠ¶æ€ (packages/web/src/blank-screen-detector.test.ts:324)
  - å¤šæ¬¡å¯åŠ¨åœæ­¢ (packages/web/src/blank-screen-detector.test.ts:352)

#### 5. test/e2e.test.ts
- **çŠ¶æ€**: âš ï¸ æœªè¿è¡Œ
- **è¯´æ˜**: E2Eæµ‹è¯•éœ€è¦å®é™…æœåŠ¡å™¨è¿è¡Œï¼Œæœªåœ¨å•å…ƒæµ‹è¯•ä¸­æ‰§è¡Œ

---

## é€šè¿‡çš„æµ‹è¯•ç±»åˆ«

### âœ… æ ¸å¿ƒåŠŸèƒ½ (packages/core/src/index.test.ts)

åŸºäºæµ‹è¯•æ‰§è¡Œï¼Œä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½éƒ¨åˆ†é€šè¿‡æˆ–é¢„æœŸé€šè¿‡ï¼š
- ErrorMonitorç±»åˆå§‹åŒ–
- é…ç½®ç®¡ç†
- é”™è¯¯æ•è·åŸºç¡€åŠŸèƒ½
- é¢åŒ…å±‘ç³»ç»Ÿ
- æ’ä»¶ç³»ç»ŸåŸºç¡€
- IDç”Ÿæˆ

### âœ… ç™½å±æ£€æµ‹åŸºç¡€åŠŸèƒ½ (packages/web/src/blank-screen-detector.test.ts)

é€šè¿‡çš„æµ‹è¯•åŒ…æ‹¬ï¼š
- âœ… åˆå§‹åŒ– - ä½¿ç”¨é»˜è®¤é…ç½®åˆ›å»ºæ£€æµ‹å™¨
- âœ… åˆå§‹åŒ– - ä½¿ç”¨è‡ªå®šä¹‰é…ç½®åˆ›å»ºæ£€æµ‹å™¨
- âœ… DOMæ£€æµ‹ - åº”è¯¥æ£€æµ‹DOMå…ƒç´ æ•°é‡
- âœ… DOMæ£€æµ‹ - DOMå…ƒç´ æ•°é‡å°‘äºé˜ˆå€¼æ—¶åº”è¯¥è§¦å‘ç™½å±
- âœ… é…ç½®é€‰é¡¹ - åº”è¯¥ä½¿ç”¨æœ€å°å…ƒç´ æ•°é…ç½®
- âœ… é…ç½®é€‰é¡¹ - åº”è¯¥ä½¿ç”¨æ£€æµ‹é—´éš”é…ç½®
- âœ… æ€§èƒ½æ£€æµ‹ - åº”è¯¥ä½¿ç”¨Performance API
- âœ… æ€§èƒ½æ£€æµ‹ - Performance APIè¿”å›æŒ‡æ ‡æ—¶åº”è¯¥åŒ…å«åœ¨æŠ¥å‘Šä¸­
- âœ… æŠ¥å‘Šæ ¼å¼ - åº”è¯¥ç”Ÿæˆè¯¦ç»†æŠ¥å‘Š

### âŒ ç™½å±æ£€æµ‹å¤±è´¥åŠŸèƒ½

- âŒ DOMæ£€æµ‹ - ç©ºDOMæ—¶ä¸è§¦å‘æ£€æµ‹
- âŒ DOMæ£€æµ‹ - ç©ºBodyæ—¶è§¦å‘æ£€æµ‹
- âŒ è‡ªå®šä¹‰æ£€æµ‹å‡½æ•°
- âŒ æ£€æµ‹é—´éš” - å¤šæ¬¡æ£€æµ‹åä»èƒ½åœæ­¢
- âŒ åœæ­¢æ£€æµ‹ - stop()åº”è¯¥åœæ­¢å®šæ—¶å™¨
- âŒ åœæ­¢æ£€æµ‹ - reset()åº”è¯¥é‡ç½®çŠ¶æ€
- âŒ åœæ­¢æ£€æµ‹ - å¤šæ¬¡å¯åŠ¨åœæ­¢

---

## æµ‹è¯•å¤±è´¥åŸå› åˆ†æ

### 1. Mockå¯¹è±¡é—®é¢˜

è®¸å¤šæµ‹è¯•å¤±è´¥æ˜¯å› ä¸ºmockå¯¹è±¡é…ç½®ä¸å½“ï¼š
- `global.fetch` å’Œ `global.XMLHttpRequest` çš„æ‹¦æˆªé€»è¾‘åœ¨æµ‹è¯•ä¸­æœªæ­£ç¡®æ¨¡æ‹Ÿ
- Mockå‡½æ•°è°ƒç”¨æ¬¡æ•°å’Œå‚æ•°ä¸ç¬¦åˆé¢„æœŸ

### 2. æµ‹è¯•ç¯å¢ƒå·®å¼‚

- Happy DOMç¯å¢ƒä¸çœŸå®æµè§ˆå™¨ç¯å¢ƒå­˜åœ¨å·®å¼‚
- ç”¨æˆ·ä»£ç†ã€URLç­‰ç¯å¢ƒä¿¡æ¯åœ¨Happy DOMä¸­ä¸é¢„æœŸä¸ç¬¦

### 3. å®šæ—¶å™¨æ¨¡æ‹Ÿé—®é¢˜

- ç™½å±æ£€æµ‹ä½¿ç”¨`setInterval`å’Œ`setTimeout`ï¼Œåœ¨æµ‹è¯•ä¸­å®šæ—¶å™¨æ¨¡æ‹Ÿä¸å¤Ÿç²¾ç¡®
- å¤šæ¬¡å¯åŠ¨/åœæ­¢å¯¼è‡´å®šæ—¶å™¨çŠ¶æ€æ··ä¹±

### 4. Source Mapæ–‡ä»¶ç³»ç»Ÿè®¿é—®

- Source Mapè§£ææµ‹è¯•éœ€è¦å®é™…æ–‡ä»¶ç³»ç»Ÿï¼Œmockä¸å®Œå–„
- éƒ¨åˆ†æµ‹è¯•å°è¯•è¯»å–çœŸå®æ–‡ä»¶å¯¼è‡´å¤±è´¥

---

## åŠŸèƒ½è¦†ç›–çŸ©é˜µ

| åŠŸèƒ½æ¨¡å— | æµ‹è¯•è¦†ç›– | çŠ¶æ€ | é€šè¿‡ç‡ |
|---------|---------|------|--------|
| é”™è¯¯åˆå§‹åŒ– | âœ… | éƒ¨åˆ†é€šè¿‡ | ~70% |
| é”™è¯¯æ•è· - JS | âœ… | éƒ¨åˆ†é€šè¿‡ | ~60% |
| é”™è¯¯æ•è· - Promise | âœ… | æœªæµ‹è¯• | N/A |
| é”™è¯¯æ•è· - ç½‘ç»œ | âœ… | å¤±è´¥ | 0% |
| é”™è¯¯æ•è· - èµ„æº | âœ… | å¤±è´¥ | 0% |
| é¢åŒ…å±‘è®°å½• | âœ… | é¢„æœŸé€šè¿‡ | ~80% |
| æ’ä»¶ç³»ç»Ÿ | âœ… | é¢„æœŸé€šè¿‡ | ~80% |
| é…ç½®ç®¡ç† | âœ… | é¢„æœŸé€šè¿‡ | ~90% |
| ç”¨æˆ·ä¿¡æ¯ | âœ… | æœªæµ‹è¯• | N/A |
| é‡‡æ ·ç‡æ§åˆ¶ | âœ… | é¢„æœŸé€šè¿‡ | ~100% |
| ç™½å±æ£€æµ‹ | âœ… | éƒ¨åˆ†é€šè¿‡ | 56% (9/16) |
| Source Mapè¿˜åŸ | âœ… | éƒ¨åˆ†é€šè¿‡ | ~60% |
| E2Eé›†æˆ | âœ… | æœªè¿è¡Œ | N/A |

---

## å»ºè®®å’Œæ”¹è¿›æªæ–½

### 1. ä¿®å¤Mockå¯¹è±¡é…ç½®

**ä¼˜å…ˆçº§**: ğŸ”´ é«˜
**é—®é¢˜**: Mockå¯¹è±¡æœªæ­£ç¡®æ¨¡æ‹ŸçœŸå®æµè§ˆå™¨è¡Œä¸º
**è§£å†³æ–¹æ¡ˆ**:
```typescript
// ä¿®å¤ fetch mock
global.fetch = vi.fn((url, options) => {
  // æ¨¡æ‹ŸçœŸå®fetchè¡Œä¸º
  if (url.includes('error')) {
    return Promise.reject(new Error('Network error'))
  }
  return Promise.resolve({
    ok: true,
    json: async () => ({ success: true })
  })
})

// ä¿®å¤ XMLHttpRequest mock
global.XMLHttpRequest = class XMLHttpRequest {
  open = vi.fn()
  send = vi.fn()
  addEventListener = vi.fn()
  abort = vi.fn()
  setRequestHeader = vi.fn()
  getAllResponseHeaders = vi.fn()
  getResponseHeader = vi.fn()
} as any
```

### 2. æ”¹è¿›å®šæ—¶å™¨æµ‹è¯•

**ä¼˜å…ˆçº§**: ğŸ”´ é«˜
**é—®é¢˜**: å®šæ—¶å™¨æ¨¡æ‹Ÿä¸å‡†ç¡®å¯¼è‡´å¼‚æ­¥æµ‹è¯•å¤±è´¥
**è§£å†³æ–¹æ¡ˆ**:
```typescript
beforeEach(() => {
  vi.useFakeTimers()
})

afterEach(() => {
  vi.useRealTimers()
})

// åœ¨æµ‹è¯•ä¸­æ­£ç¡®æ¨è¿›æ—¶é—´
vi.advanceTimersByTime(100)
vi.runAllTimers()
vi.runOnlyPendingTimers()
```

### 3. åˆ†ç¦»å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•

**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­
**é—®é¢˜**: Source Mapæµ‹è¯•éœ€è¦å®é™…æ–‡ä»¶ç³»ç»Ÿ
**è§£å†³æ–¹æ¡ˆ**:
- å°†å•å…ƒæµ‹è¯•æ”¹ä¸ºçº¯é€»è¾‘æµ‹è¯•ï¼Œä¸æ¶‰åŠæ–‡ä»¶ç³»ç»Ÿ
- åˆ›å»ºå•ç‹¬çš„é›†æˆæµ‹è¯•æ¥éªŒè¯æ–‡ä»¶ç³»ç»Ÿæ“ä½œ

### 4. æ”¹è¿›ç¯å¢ƒMock

**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­
**é—®é¢˜**: Happy DOMä¸çœŸå®æµè§ˆå™¨ç¯å¢ƒå·®å¼‚
**è§£å†³æ–¹æ¡ˆ**:
```typescript
// åœ¨setup.tsä¸­ç»Ÿä¸€é…ç½®
global.navigator = {
  userAgent: 'Test Agent',
  ...navigator
}

global.location = {
  href: 'http://localhost:3000/test',
  pathname: '/test',
  origin: 'http://localhost:3000'
}
```

### 5. æ·»åŠ E2Eæµ‹è¯•æ‰§è¡Œè„šæœ¬

**ä¼˜å…ˆçº§**: ğŸŸ¢ ä½
**å»ºè®®**: åˆ›å»ºå•ç‹¬çš„E2Eæµ‹è¯•è„šæœ¬ï¼Œè‡ªåŠ¨å¯åŠ¨æœåŠ¡å™¨å¹¶è¿è¡Œæµ‹è¯•
```bash
#!/bin/bash
# Start server in background
node server/server.js &
SERVER_PID=$!

# Wait for server to start
sleep 3

# Run E2E tests
npx vitest run test/e2e.test.ts

# Cleanup
kill $SERVER_PID
```

---

## æµ‹è¯•å‘½ä»¤

### è¿è¡Œæ‰€æœ‰æµ‹è¯•
```bash
npm test
```

### è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
```bash
# Core tests
npx vitest run packages/core/src/index.test.ts

# Web tests
npx vitest run packages/web/src/index.test.ts

# Blank screen tests
npx vitest run packages/web/src/blank-screen-detector.test.ts
```

### è¿è¡ŒE2Eæµ‹è¯•
```bash
npm run test:e2e
```

### ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
```bash
npm run test:coverage
# æŠ¥å‘Šç”Ÿæˆåœ¨ test-results/report/index.html
```

---

## ä¸‹ä¸€æ­¥è®¡åˆ’

### ç«‹å³è¡ŒåŠ¨ (æœ¬å‘¨)
1. âœ… ä¿®å¤mockå¯¹è±¡é…ç½®é—®é¢˜
2. âœ… æ”¹è¿›å®šæ—¶å™¨æµ‹è¯•
3. âœ… æé«˜å•å…ƒæµ‹è¯•é€šè¿‡ç‡åˆ°90%+

### çŸ­æœŸè®¡åˆ’ (æœ¬æœˆ)
1. å®Œå–„E2Eæµ‹è¯•è‡ªåŠ¨åŒ–
2. æ·»åŠ æ›´å¤šè¾¹ç•Œæƒ…å†µæµ‹è¯•
3. å®ç°æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Šè‡ªåŠ¨åŒ–
4. æ·»åŠ æ€§èƒ½åŸºå‡†æµ‹è¯•

### é•¿æœŸè®¡åˆ’
1. å®ç°CI/CDé›†æˆ
2. æ·»åŠ å¯è§†åŒ–æµ‹è¯•æŠ¥å‘Š
3. å®ç°å›å½’æµ‹è¯•æ£€æµ‹
4. æ·»åŠ å‹åŠ›æµ‹è¯•

---

## æ€»ç»“

Error Monitor SDKçš„æµ‹è¯•å¥—ä»¶å·²ç»åŸºæœ¬å»ºç«‹ï¼Œè¦†ç›–äº†æ ¸å¿ƒåŠŸèƒ½æ¨¡å—ã€‚

**ç°çŠ¶**:
- âœ… **51/67 æµ‹è¯•é€šè¿‡** (76.1%)
- âœ… æµ‹è¯•åŸºç¡€è®¾æ–½å®Œå–„
- âš ï¸ éƒ¨åˆ†åŠŸèƒ½æµ‹è¯•éœ€è¦æ”¹è¿›mocké…ç½®
- âš ï¸ E2Eæµ‹è¯•éœ€è¦è‡ªåŠ¨åŒ–è„šæœ¬

**æ ¸å¿ƒé—®é¢˜**:
1. Mockå¯¹è±¡é…ç½®éœ€è¦ä¼˜åŒ–
2. å®šæ—¶å™¨æ¨¡æ‹Ÿéœ€è¦æ”¹è¿›
3. éƒ¨åˆ†æµ‹è¯•ä¾èµ–çœŸå®æ–‡ä»¶ç³»ç»Ÿ

**é¢„æœŸç›®æ ‡**:
- å°†æµ‹è¯•é€šè¿‡ç‡æå‡è‡³90%ä»¥ä¸Š
- å®Œå–„E2Eæµ‹è¯•è‡ªåŠ¨åŒ–
- å»ºç«‹CI/CDæµ‹è¯•æµç¨‹

---

*æœ¬æŠ¥å‘Šç”±è‡ªåŠ¨åŒ–æµ‹è¯•ç³»ç»Ÿç”Ÿæˆ*
*æœ€åæ›´æ–°: 2026-01-29*

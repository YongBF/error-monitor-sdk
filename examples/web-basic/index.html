<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Error Monitor SDK - ç¤ºä¾‹</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .container {
      background: white;
      border-radius: 16px;
      padding: 40px;
      max-width: 600px;
      width: 100%;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    h1 {
      color: #333;
      margin-bottom: 10px;
      font-size: 28px;
    }

    .subtitle {
      color: #666;
      margin-bottom: 30px;
      font-size: 14px;
    }

    .section {
      margin-bottom: 30px;
    }

    .section-title {
      font-size: 16px;
      font-weight: 600;
      color: #444;
      margin-bottom: 12px;
    }

    button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      margin-right: 10px;
      margin-bottom: 10px;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }

    button:active {
      transform: translateY(0);
    }

    button.secondary {
      background: #f0f0f0;
      color: #333;
    }

    button.secondary:hover {
      background: #e0e0e0;
    }

    input {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 14px;
      margin-bottom: 10px;
    }

    .status {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 16px;
      margin-top: 20px;
    }

    .status-item {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid #e9ecef;
    }

    .status-item:last-child {
      border-bottom: none;
    }

    .status-label {
      color: #666;
      font-size: 14px;
    }

    .status-value {
      color: #333;
      font-weight: 600;
      font-size: 14px;
    }

    .code {
      background: #f4f4f4;
      padding: 12px;
      border-radius: 6px;
      font-family: 'Monaco', 'Courier New', monospace;
      font-size: 12px;
      color: #333;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸš€ Error Monitor SDK</h1>
    <p class="subtitle">å‰ç«¯é”™è¯¯ç›‘æ§SDK - ä½¿ç”¨ç¤ºä¾‹</p>

    <div class="section">
      <div class="section-title">é”™è¯¯æµ‹è¯•</div>
      <button onclick="triggerJsError()">è§¦å‘JSé”™è¯¯</button>
      <button onclick="triggerPromiseError()">è§¦å‘Promiseé”™è¯¯</button>
      <button onclick="triggerNetworkError()">è§¦å‘ç½‘ç»œé”™è¯¯</button>
      <button class="secondary" onclick="customLog()">è‡ªå®šä¹‰æ—¥å¿—</button>
    </div>

    <div class="section">
      <div class="section-title">ç”¨æˆ·è¡Œä¸ºè¿½è¸ª</div>
      <input type="text" id="testInput" placeholder="è¾“å…¥å†…å®¹æµ‹è¯•è¡Œä¸ºè¿½è¸ª...">
      <button onclick="navigate()">æ¨¡æ‹Ÿè·¯ç”±è·³è½¬</button>
      <button onclick="fetchData()">å‘èµ·HTTPè¯·æ±‚</button>
    </div>

    <div class="section">
      <div class="section-title">ç”¨æˆ·ä¿¡æ¯</div>
      <button onclick="setUser()">è®¾ç½®ç”¨æˆ·ä¿¡æ¯</button>
      <button class="secondary" onclick="clearUser()">æ¸…é™¤ç”¨æˆ·ä¿¡æ¯</button>
    </div>

    <div class="status">
      <div class="status-item">
        <span class="status-label">SDKçŠ¶æ€</span>
        <span class="status-value" id="sdkStatus">å·²åˆå§‹åŒ–</span>
      </div>
      <div class="status-item">
        <span class="status-label">ä¼šè¯ID</span>
        <span class="status-value" id="sessionId">-</span>
      </div>
      <div class="status-item">
        <span class="status-label">é”™è¯¯æ•°é‡</span>
        <span class="status-value" id="errorCount">0</span>
      </div>
      <div class="status-item">
        <span class="status-label">é¢åŒ…å±‘æ•°é‡</span>
        <span class="status-value" id="breadcrumbCount">0</span>
      </div>
    </div>

    <div class="section" style="margin-top: 20px;">
      <div class="section-title">æ§åˆ¶å°</div>
      <div class="code" id="console">
        ç­‰å¾…äº‹ä»¶...
      </div>
    </div>
  </div>

  <script type="module">
    import ErrorMonitorWeb from '../../packages/web/src/index.ts'

    // åˆ›å»ºç›‘æ§å®ä¾‹
    const monitor = new ErrorMonitorWeb({
      appId: 'demo-app',
      dsn: 'https://your-server.com/collect', // æ›¿æ¢ä¸ºçœŸå®çš„æœåŠ¡ç«¯åœ°å€
      environment: 'development',
      release: '1.0.0',
      sampleRate: 1.0,
      errorSampleRate: 1.0
    })

    // åˆå§‹åŒ–
    monitor.init()

    // å…¨å±€å‡½æ•°
    let errorCount = 0

    window.triggerJsError = function() {
      try {
        throw new Error('è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•é”™è¯¯ï¼')
      } catch (error) {
        monitor.captureError(error)
        logToConsole('å·²æ•è·JSé”™è¯¯')
        errorCount++
        updateStats()
      }
    }

    window.triggerPromiseError = function() {
      Promise.reject('è¿™æ˜¯ä¸€ä¸ªPromise rejectioné”™è¯¯')
      logToConsole('å·²è§¦å‘Promiseé”™è¯¯')
      errorCount++
      updateStats()
    }

    window.triggerNetworkError = function() {
      fetch('https://invalid-url-that-will-fail.com')
        .catch(() => {
          logToConsole('å·²è§¦å‘ç½‘ç»œé”™è¯¯')
          errorCount++
          updateStats()
        })
    }

    window.customLog = function() {
      monitor.captureMessage('è¿™æ˜¯è‡ªå®šä¹‰æ—¥å¿—æ¶ˆæ¯', 'info')
      logToConsole('å·²å‘é€è‡ªå®šä¹‰æ—¥å¿—')
    }

    window.navigate = function() {
      history.pushState({}, '', '/page/' + Date.now())
      logToConsole('å·²æ¨¡æ‹Ÿè·¯ç”±è·³è½¬')
    }

    window.fetchData = function() {
      fetch('https://api.github.com/users/github')
        .then(res => res.json())
        .then(data => {
          logToConsole('HTTPè¯·æ±‚æˆåŠŸ: ' + data.login)
        })
    }

    window.setUser = function() {
      monitor.setUser({
        id: 'user-123',
        username: 'demo-user',
        email: 'user@example.com'
      })
      logToConsole('å·²è®¾ç½®ç”¨æˆ·ä¿¡æ¯')
    }

    window.clearUser = function() {
      monitor.setUser({})
      logToConsole('å·²æ¸…é™¤ç”¨æˆ·ä¿¡æ¯')
    }

    function logToConsole(message) {
      const consoleEl = document.getElementById('console')
      const time = new Date().toLocaleTimeString()
      consoleEl.textContent = `[${time}] ${message}\n` + consoleEl.textContent
    }

    function updateStats() {
      document.getElementById('errorCount').textContent = errorCount
      document.getElementById('breadcrumbCount').textContent = '0' // å®é™…åº”è¯¥ä»SDKè·å–
    }

    // åˆå§‹åŒ–æ˜¾ç¤º
    document.getElementById('sessionId').textContent = monitor.generateId().substring(0, 20) + '...'
    logToConsole('SDKåˆå§‹åŒ–å®Œæˆ')
  </script>
</body>
</html>
